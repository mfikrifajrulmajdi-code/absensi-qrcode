# ğŸ—„ï¸ V2 Database Schema

## Overview

Dokumentasi struktur database Sistem Absensi QR Code V2 yang menggunakan Google Sheets sebagai database.

---

## ğŸ“Š Sheets Structure

V2 menggunakan **3 sheets** di Google Sheets:

| Sheet Name | Deskripsi | Jumlah Kolom |
|------------|-----------|--------------|
| **Absensi** | Data absensi karyawan | 10 kolom |
| **Izin** | Data pengajuan izin/sakit/cuti | 8 kolom |
| **Config** | Konfigurasi sistem | 2 kolom |

---

## 1. Sheet "Absensi"

Menyimpan semua data absensi (MASUK/PULANG).

### Kolom & Tipe Data

| Kolom | A | B | C | D | E | F | G | H | I | J |
|-------|---|---|---|---|---|---|---|---|---|---|
| **Header** | Timestamp | Nama | Tipe | Latitude | Longitude | Device Type | OS | Browser | User Agent | Foto |
| **Type** | DateTime | String | String | Number | Number | String | String | String | String | URL |
| **Required** | Yes | Yes | Yes | No | No | Yes | Yes | Yes | Yes | No* |

*Foto wajib di V2, tapi bisa kosong untuk data auto-fix

### Format Data per Kolom

| Kolom | Format | Contoh | Keterangan |
|-------|--------|--------|------------|
| **Timestamp** | `yyyy-MM-dd HH:mm:ss` | `2026-02-03 08:15:22` | Waktu server (Asia/Jakarta) |
| **Nama** | String | `Budi Santoso` | Nama karyawan |
| **Tipe** | Enum: `MASUK`, `PULANG` | `MASUK` | Tipe absensi |
| **Latitude** | Decimal (6 digits) | `-6.123456` | Koordinat GPS |
| **Longitude** | Decimal (6 digits) | `106.765432` | Koordinat GPS |
| **Device Type** | Enum: `Mobile`, `Tablet`, `Desktop` | `Mobile` | Tipe device |
| **OS** | Enum: `Android`, `iOS`, `Windows`, `MacOS`, `Linux`, `Unknown` | `Android` | Operating system |
| **Browser** | Enum: `Chrome`, `Safari`, `Firefox`, `Edge`, `Opera`, `Unknown` | `Chrome` | Web browser |
| **User Agent** | String | `Mozilla/5.0...` | Full user agent |
| **Foto** | URL | `https://i.ibb.co/xxx/foto.jpg` | URL foto absensi |

### Contoh Data

```
| Timestamp            | Nama         | Tipe  | Latitude  | Longitude   | Device Type | OS      | Browser | User Agent                  | Foto                         |
|----------------------|--------------|-------|-----------|-------------|-------------|---------|---------|-----------------------------|------------------------------|
| 2026-02-03 08:15:22  | Budi Santoso | MASUK | -6.123456 | 106.765432  | Mobile      | Android | Chrome  | Mozilla/5.0 (Linux; Android) | https://i.ibb.co/abc123.jpg  |
| 2026-02-03 17:00:45  | Budi Santoso | PULANG| -6.123456 | 106.765432  | Mobile      | Android | Chrome  | Mozilla/5.0 (Linux; Android) | https://i.ibb.co/def456.jpg  |
| 2026-02-03 08:20:10  | Siti Aminah  | MASUK | -6.124567 | 106.765433  | Mobile      | iOS     | Safari  | Mozilla/5.0 (iPhone; CPU...) | https://i.ibb.co/ghi789.jpg  |
| 2026-02-02 16:00:00  | Budi Santoso | PULANG|           |             |             |         |         |                             |                              |
```

**Note:** Row 4 adalah data auto-fix (lupa absen pulang) - latitude/longitude/foto kosong.

### Format Kolom (Google Sheets)

| Kolom | Width | Format |
|-------|-------|--------|
| Timestamp | 180px | Date time |
| Nama | 200px | Plain text |
| Tipe | 80px | Plain text |
| Latitude | 120px | Number, 6 decimal places |
| Longitude | 120px | Number, 6 decimal places |
| Device Type | 100px | Plain text |
| OS | 100px | Plain text |
| Browser | 100px | Plain text |
| User Agent | 200px | Plain text |
| Foto | 300px | Hyperlink |

### Validasi

| Rule | Deskripsi |
|------|-----------|
| `Timestamp` | Auto-generated by server |
| `Nama` | Required, tidak boleh kosong |
| `Tipe` | Hanya `MASUK` atau `PULANG` |
| `Latitude` | -90 s/d 90 |
| `Longitude` | -180 s/d 180 |
| `Foto` | Harus URL valid jika ada |

---

## 2. Sheet "Izin"

Menyimpan data pengajuan izin/sakit/cuti.

### Kolom & Tipe Data

| Kolom | A | B | C | D | E | F | G | H |
|-------|---|---|---|---|---|---|---|---|
| **Header** | Timestamp | Nama | Jenis | Tanggal | Alasan | Lampiran | Status | Updated At |
| **Type** | DateTime | String | String | Date | String | URL | Enum | DateTime |
| **Required** | Yes | Yes | Yes | Yes | Yes | No | Yes | Yes |

### Format Data per Kolom

| Kolom | Format | Contoh | Keterangan |
|-------|--------|--------|------------|
| **Timestamp** | `yyyy-MM-dd HH:mm:ss` | `2026-02-03 07:30:00` | Waktu submit |
| **Nama** | String | `Budi Santoso` | Nama karyawan |
| **Jenis** | Enum: `Sakit`, `Izin`, `Cuti` | `Sakit` | Jenis izin |
| **Tanggal** | `yyyy-MM-dd` | `2026-02-03` | Tanggal izin |
| **Alasan** | Text | `Demam tinggi` | Alasan izin |
| **Lampiran** | URL | `https://i.ibb.co/xxx/surat.jpg` | URL dokumen pendukung |
| **Status** | Enum: `PENDING`, `APPROVED`, `REJECTED` | `APPROVED` | Status approval |
| **Updated At** | `yyyy-MM-dd HH:mm:ss` | `2026-02-03 09:15:00` | Waktu terakhir di-update |

### Contoh Data

```
| Timestamp            | Nama         | Jenis | Tanggal    | Alasan              | Lampiran                   | Status    | Updated At           |
|----------------------|--------------|-------|------------|---------------------|----------------------------|-----------|----------------------|
| 2026-02-03 07:30:00  | Budi Santoso | Sakit | 2026-02-03 | Demam tinggi        | https://i.ibb.co/surat.jpg | APPROVED  | 2026-02-03 09:15:00  |
| 2026-02-03 08:00:00  | Siti Aminah  | Izin  | 2026-02-03 | Acara keluarga      |                            | PENDING   | 2026-02-03 08:00:00  |
| 2026-02-02 18:00:00  | Rudi Hartono | Cuti  | 2026-02-10 | Liburan keluarga    |                            | PENDING   | 2026-02-02 18:00:00  |
```

### Format Kolom (Google Sheets)

| Kolom | Width | Format |
|-------|-------|--------|
| Timestamp | 180px | Date time |
| Nama | 200px | Plain text |
| Jenis | 80px | Plain text |
| Tanggal | 120px | Date |
| Alasan | 250px | Plain text |
| Lampiran | 300px | Hyperlink |
| Status | 100px | Plain text (with color) |
| Updated At | 180px | Date time |

### Conditional Formatting (Status)

| Status | Background Color | Text Color |
|--------|------------------|------------|
| PENDING | `#FFF3CD` | `#856404` (Kuning) |
| APPROVED | `#D4EDDA` | `#155724` (Hijau) |
| REJECTED | `#F8D7DA` | `#721C24` (Merah) |

---

## 3. Sheet "Config"

Menyimpan konfigurasi sistem.

### Kolom & Tipe Data

| Kolom | A | B |
|-------|---|---|
| **Header** | Key | Value |
| **Type** | String | String/Number |
| **Required** | Yes | Yes |

### Data Config

| Key | Value | Deskripsi |
|-----|-------|-----------|
| `jam_kerja` | `8` | Jumlah jam kerja regular (jam) |
| `max_lembur` | `2` | Maksimal kali lembur per hari |
| `versi` | `2.0` | Versi sistem |
| `auto_fix_enabled` | `true` | Enable/disable auto-fix |

---

## ğŸ”— Relationships

### Relasi Antar Sheet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sheet Config  â”‚
â”‚  (konfigurasi)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ reference
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sheet Absensi  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Sheet Izin     â”‚
â”‚  (log absensi)  â”‚         â”‚  (pengajuan)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                             â”‚
       â”‚                             â”‚
       â”‚ used for                    â”‚
       â”‚                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard      â”‚         â”‚  Summary        â”‚
â”‚  (admin view)   â”‚         â”‚  (statistics)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Join Logic

**Untuk mendapatkan kehadiran lengkap:**

```sql
-- Pseudo-SQL
SELECT
    a.Nama,
    a.Tanggal,
    CASE
        WHEN i.Status = 'APPROVED' THEN i.Jenis
        WHEN a.MASUK IS NOT NULL THEN 'Hadir'
        ELSE 'Alpha'
    END as StatusKehadiran
FROM Absensi a
LEFT JOIN Izin i ON a.Nama = i.Nama AND a.Tanggal = i.Tanggal
```

---

## ğŸ“ˆ Statistics Queries

### Total Hadir Hari Ini

```javascript
// Google Apps Script
function getTotalHadirHariIni() {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Absensi");
    var data = sheet.getDataRange().getValues();

    var today = Utilities.formatDate(new Date(), "Asia/Jakarta", "yyyy-MM-dd");
    var uniqueNames = new Set();

    for (var i = 1; i < data.length; i++) {
        var rowDate = data[i][0].toString().substring(0, 10);
        if (rowDate === today && data[i][2] === 'MASUK') {
            uniqueNames.add(data[i][1]);
        }
    }

    return uniqueNames.size;
}
```

### Summary Dashboard

```javascript
function getSummaryHariIni() {
    var totalKaryawan = 30; // Dari config atau database karyawan

    var absensiSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Absensi");
    var izinSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Izin");

    // Get absensi hari ini
    var todayData = getTodayAbsensi(absensiSheet);
    var masukCount = todayData.masuk.length;
    var pulangCount = todayData.pulang.length;

    // Get izin approved hari ini
    var izinData = getTodayIzinApproved(izinSheet);
    var izinCount = izinData.length;

    // Hitung belum absen
    var belumCount = totalKaryawan - masukCount - izinCount;

    return {
        totalKaryawan: totalKaryawan,
        masuk: masukCount,
        pulang: pulangCount,
        izin: izinCount,
        belum: belumCount
    };
}
```

---

## ğŸ”„ Data Migration V1 â†’ V2

### Steps:

1. **Backup data V1**
   - Download existing "Absensi" sheet as Excel

2. **Add new columns**
   - Add column I: "User Agent"
   - Add column J: "Foto"

3. **Migrate "Device Info" columns**
   - Rename existing columns if needed

4. **Create new sheets**
   - Create "Izin" sheet
   - Create "Config" sheet

5. **Verify data integrity**

---

## ğŸ’¾ Backup & Recovery

### Automated Backup

Google Sheets auto-save, tapi recommended untuk manual backup:

**Frequency:** Daily

**Method:**
1. File â†’ Download â†’ Microsoft Excel
2. Save to cloud storage (Drive/Dropbox)

### Recovery Steps:

1. Buka Google Sheets
2. File â†’ Version history â†’ See version history
3. Pilih version yang akan di-restore
4. Klik "Restore this version"

---

## ğŸ“Š Data Retention Policy

| Data Type | Retention | Archive Location |
|-----------|-----------|------------------|
| Absensi | 1 tahun | Archive sheet |
| Izin | 2 tahun | Archive sheet |
| Config | Permanent | - |

**Recommendation:** Buat sheet "Archive" untuk data lama.

---

## ğŸ”’ Data Privacy

### Sensitive Data

| Data | Privacy Level | Action |
|------|---------------|--------|
| Foto absensi | High | Encrypted URL |
| GPS Location | Medium | Rounded to 6 decimals |
| User Agent | Low | - |

### GDPR Compliance

- Right to access: Karyawan bisa request riwayat pribadi
- Right to deletion: Data bisa di-delete setelah retention period
- Data minimization: Hanya collect data yang necessary

---

## ğŸ“š Related Documents

- [08_V2_FEATURES.md](./08_V2_FEATURES.md) - Overview fitur V2
- [09_V2_IMPLEMENTATION.md](./09_V2_IMPLEMENTATION.md) - Panduan implementasi
- [10_V2_API.md](./10_V2_API.md) - Dokumentasi API

---

**Version:** 2.0
**Last Updated:** 3 Februari 2026
**Status:** DRAFT
